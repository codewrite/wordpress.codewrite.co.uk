<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-3695330-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-3695330-4');
</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Capacitance measurement with the Arduino Uno | PIC Tutorials</title>
<link rel="profile" href="../../../../../xfn/11.html" />
<link rel="stylesheet" type="text/css" media="all" href="../../../../wp-content/themes/twentyeleven/style.css" />
<link rel="alternate" type="application/rss+xml" title="PIC Tutorials &raquo; Feed" href="../../../../feed/" />
<link rel="alternate" type="application/rss+xml" title="PIC Tutorials &raquo; Comments Feed" href="../../../../comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="PIC Tutorials &raquo; Capacitance measurement with the Arduino Uno Comments Feed" href="feed/" />
<link rel='stylesheet' id='collapseomatic-css-css'  href='../../../../wp-content/plugins/jquery-collapse-o-matic/light_style00e2.css?ver=1.5.7' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jqueryc1d8.js?ver=1.11.3'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min1576.js?ver=1.2.1'></script>
<link rel='prev' title='nRF24L01 Test board PCB' href='../../13/nrf24l01-test-board-pcb/' />
<link rel='next' title='Arduino Capacitance Meter Resolution' href='../arduino-cap-meter-res/' />
<link rel='canonical' href='index.html' />
<link rel="stylesheet" href="/cookiealert.css">
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
</head>

<body class="single single-post postid-229 single-format-standard single-author singular two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="../../../../" rel="home">PIC Tutorials</a></span></h1>
				<h2 id="site-description">Electronics and Programming Simplified</h2>
			</hgroup>

						<a href="../../../../">
									<img src="../../../../wp-content/uploads/sites/2/2013/07/cropped-header1.png" width="1000" height="288" alt="" />
							</a>
			
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="#content">Skip to primary content</a></div>
												<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-349" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-349"><a href="../../../../../ham/">Amateur Radio</a></li>
<li id="menu-item-351" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-351"><a href="../../../../about/">About</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h3 class="assistive-text">Post navigation</h3>
						<span class="nav-previous"><a href="../../13/nrf24l01-test-board-pcb/" rel="prev"><span class="meta-nav">&larr;</span> Previous</a></span>
						<span class="nav-next"><a href="../arduino-cap-meter-res/" rel="next">Next <span class="meta-nav">&rarr;</span></a></span>
					</nav><!-- #nav-single -->

					
<article id="post-229" class="post-229 post type-post status-publish format-standard hentry category-general">
	<header class="entry-header">
		<h1 class="entry-title">Capacitance measurement with the Arduino Uno</h1>

				<div class="entry-meta">
			<span class="sep">Posted on </span><a href="index.html" title="4:06 pm" rel="bookmark"><time class="entry-date" datetime="2014-01-21T16:06:19+00:00">January 21, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../../../author/jon/" title="View all posts by jon" rel="author">jon</a></span></span>		</div><!-- .entry-meta -->
			</header><!-- .entry-header -->

	<div class="entry-content">
		<p>You can buy meters, like this one for instance:</p>
<p><a title="PEAK LCR40" href="http://www.peakelec.co.uk/acatalog/jz_lcr40.html"><img class="alignnone size-medium wp-image-231" style="color: #333333; font-style: normal;" alt="Peak_LCR40" src="../../../../wp-content/uploads/sites/2/2014/01/Peak_LCR40-300x201.jpg" width="300" height="201" /></a></p>
<p>that measure capacitance, but where&#8217;s the fun in that?!</p>
<p>If you&#8217;ve got an Arduino, why not build one instead?</p>
<p><strong>Update:</strong> Thank you for all the interest in this article! I have managed to increase the range, so it can measure capacitances of less than 1pF to over 1000uF , still with no external components! I&#8217;ve called this the <a title="Capacitance Meter Mk II" href="../../25/capacitance-meter-mk-ii/">Capacitance Meter Mk II</a>.</p>
<p>There are lots of examples of how to do this on the internet, but I&#8217;m going to suggest an incredibly simple way to it. Let&#8217;s start with the theory.</p>
<p>Consider the following circuit:</p>
<p><a href="../../../../wp-content/uploads/sites/2/2014/01/SimpleCapacitanceTester.png"><img class="alignnone size-medium wp-image-232" alt="SimpleCapacitanceTester" src="../../../../wp-content/uploads/sites/2/2014/01/SimpleCapacitanceTester-300x226.png" width="300" height="226" /></a></p>
<p>CT is the capacitor under test. We start with both capacitors discharged and A2 at 0 volts. When we raise A2 to 5 volts a current will flow through both capacitors. The voltage on A0 will settle to within 1% of it&#8217;s final value within 30ns. The value that A0 will settle to is proportional to the ratio of CT divided by the total capacitance, C1 + CT. The formulas that we are going to need are:</p>
<p><a href="../../../../wp-content/uploads/sites/2/2014/01/CapTestFormulas3.png"><img class="alignnone size-full wp-image-300" alt="CapTestFormulas3" src="../../../../wp-content/uploads/sites/2/2014/01/CapTestFormulas3.png" width="284" height="297" /></a></p>
<p>We will use the ADC to measure VA0. VA2 is actually 5 volts,  so VA0 will vary from 0 to 5 volts, but we can use the ADC value instead, to make the calculations easier. Obviously we should then use the maximum ADC value (1023) for VA2. The ADC readings we can expect will range from about 33 for CT = 1pF to about 993 for CT = 1nF (1000pF).</p>
<p>So now we are ready to build the circuit and write the code. Right? Well, not quite. In the circuit above we have specified C1 as 30pF. But the Arduino will have some stray capacitance on the board and in the micro-controller. About 30pF of stray capacitance. We&#8217;re going to use this to make our circuit simpler &#8211; we are going to remove C1. But we need to work out how much stray capacitance there is, so we can plug it into the formulas above. But first, we&#8217;ll build the circuit and write the code.</p>
<p>The circuit is surprisingly easy. In fact there isn&#8217;t a circuit now. We&#8217;re going to use the Arduino as follows:</p>
<p><a href="../../../../wp-content/uploads/sites/2/2014/01/CapTestBoard1.jpg"><img class="alignnone size-medium wp-image-236" alt="CapTestBoard1" src="../../../../wp-content/uploads/sites/2/2014/01/CapTestBoard1-300x168.jpg" width="300" height="168" /></a></p>
<p>The capacitor is the capacitor under test between A0 and A2. The capacitors on the right are the capacitors that I am going to test a bit later on.</p>
<p>The code looks like this:</p>
<pre>const int OUT_PIN = A2;
const int IN_PIN = A0;

//Capacitance between IN_PIN and Ground
//Stray capacitance is always present. Extra capacitance can be added to
//allow higher capacitance to be measured.
const float IN_STRAY_CAP_TO_GND = 24.48; //initially this was 30.00
const float IN_EXTRA_CAP_TO_GND = 0.0;
const float IN_CAP_TO_GND  = IN_STRAY_CAP_TO_GND + IN_EXTRA_CAP_TO_GND;
const int MAX_ADC_VALUE = 1023;

void setup()
{
  pinMode(OUT_PIN, OUTPUT);
  //digitalWrite(OUT_PIN, LOW);  //This is the default state for outputs
  pinMode(IN_PIN, OUTPUT);
  //digitalWrite(IN_PIN, LOW);

  Serial.begin(115200);
}

void loop()
{
  //Capacitor under test between OUT_PIN and IN_PIN
  //Rising high edge on OUT_PIN
  pinMode(IN_PIN, INPUT);
  digitalWrite(OUT_PIN, HIGH);
  int val = analogRead(IN_PIN);

  //Clear everything for next measurement
  digitalWrite(OUT_PIN, LOW);
  pinMode(IN_PIN, OUTPUT);

  //Calculate and print result

  float capacitance = (float)val * IN_CAP_TO_GND / (float)(MAX_ADC_VALUE - val);

  Serial.print(F("Capacitance Value = "));
  Serial.print(capacitance, 3);
  Serial.print(F(" pF ("));
  Serial.print(val);
  Serial.println(F(") "));

  while (millis() % 500 != 0)
    ;    
}</pre>
<p>The code above loops round every half second, applying a 5V pulse to the capacitor, and measuring the voltage the other side. It then prints out the calculated capacitance (and raw ADC value).</p>
<p>If we try this out it won&#8217;t be very accurate. That is because the stray capacitance isn&#8217;t exactly 30pF. So we need to calibrate it. I did this with a 100pF capacitor. My multimeter reckons that it actually has a value of 102pF. The reading I get on my Arduino board is 125pF (raw ADC value 825). So if we put VA0 = 825, VA2 = 1023 and CT = 102 into the second equation, this tells us that C1 is 24.48pF. So I changed IN_STRAY_CAP_TO_GND to 24.48 and uploaded this to the Arduino. This time the value displayed on the serial monitor is 102pF (most of the time!).</p>
<p><a href="../../../../wp-content/uploads/sites/2/2014/01/CapTestSerialMon1.png"><img class="alignnone size-medium wp-image-241" alt="CapTestSerialMon1" src="../../../../wp-content/uploads/sites/2/2014/01/CapTestSerialMon1-300x124.png" width="300" height="124" /></a></p>
<p>I tried it out with the following capacitors:</p>
<p><a href="../../../../wp-content/uploads/sites/2/2014/01/MiscCap1.jpg"><img class="alignnone size-medium wp-image-243" alt="MiscCap1" src="../../../../wp-content/uploads/sites/2/2014/01/MiscCap1-300x168.jpg" width="300" height="168" /></a></p>
<p>This was the results of my tests:</p>
<table width="189" border="0" cellspacing="0" cellpadding="0">
<colgroup>
<col width="63" />
<col width="126" /> </colgroup>
<tbody>
<tr>
<td width="63" height="17">Capacitor</td>
<td width="126">Reading</td>
</tr>
<tr>
<td height="7"></td>
<td></td>
</tr>
<tr>
<td height="17">&#8211;</td>
<td>0.072 pF (3)</td>
</tr>
<tr>
<td height="17">15J</td>
<td>15.461 pF (396)</td>
</tr>
<tr>
<td height="17">22J</td>
<td>23.403 pF (500)</td>
</tr>
<tr>
<td height="17">47J</td>
<td>48.532 pF (680)</td>
</tr>
<tr>
<td height="17">101J</td>
<td>102.000 pF (825)</td>
</tr>
<tr>
<td height="17">471K</td>
<td>448.030 pF (970)</td>
</tr>
<tr>
<td height="17">102K</td>
<td>1064.348 pF (1000)</td>
</tr>
<tr>
<td height="17">392K</td>
<td>3553.097 pF (1016)</td>
</tr>
<tr>
<td height="17">472K</td>
<td>4984.128 pF (1018)</td>
</tr>
</tbody>
</table>
<p>I was curious to know how accurate this might be, so I worked it out. <a title="Aduino Uno Capacitance Meter Resolution" href="../arduino-cap-meter-res/">You can see the results of my analysis here</a>. My conclusion was that you could expect a resolution of about 1% between 3.5pF and 225pF, and about 5% between 0.5pF and 1300pF. I haven&#8217;t worked the accuracy and linearity yet &#8211; I need to get hold of some very accurate reference capacitors (or a very accurate meter) for that.</p>
<p>You can build your own capacitor, and do experiments, <a title="Experiments with the Arduino Capacitance Meter" href="../../22/experiments-with-uno-cap-meter/">which I have demonstrated here</a>.</p>
<p>If you want to build on this or make a complete LCR meter, I <a title="Arduino LCR Meter Ideas" href="../../22/arduino-lcr-meter-ideas/">have some ideas here</a>.</p>
			</div><!-- .entry-content -->

	<footer class="entry-meta">
		This entry was posted in <a href="../../../../category/general/" rel="category tag">General</a> by <a href="../../../../author/jon/">jon</a>. Bookmark the <a href="index.html" title="Permalink to Capacitance measurement with the Arduino Uno" rel="bookmark">permalink</a>.		
			</footer><!-- .entry-meta -->
</article><!-- #post-229 -->

						<div id="comments">
	
	
			<h2 id="comments-title">
			41 thoughts on &ldquo;<span>Capacitance measurement with the Arduino Uno</span>&rdquo;		</h2>

		
		<ol class="commentlist">
				<li class="post pingback">
		<p>Pingback: <a href='http://hackaday.com/2014/01/22/capacitance-measurement-with-the-arduino-uno/' rel='external nofollow' class='url'>hackaday.com/2014/01/22/capacitance-measurement-with-the-arduino-uno</a></p>
	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='http://5jcodelabs.com/howtomrj/capacitance-measurement-with-the-arduino-uno/' rel='external nofollow' class='url'>5jcodelabs.com/howtomrj/capacitance-measurement-with-the-arduino-uno</a></p>
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-260">
		<article id="comment-260" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/0af9e4dd7878141d709abe91d5136f9f4165.jpeg?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/0af9e4dd7878141d709abe91d5136f9f?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">flegmatoid</span> on <a href="index.html#comment-260"><time datetime="2014-01-23T08:08:19+00:00">January 23, 2014 at 8:08 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>nice post<br />
In the photo I can see you&#8217;re using USB power supply. With no doubt that accounts for  the &#8220;error&#8221; in your measurements, since mostly never you&#8217;ll get the precise 5V reference on your USB port.<br />
To compensate this you could use some software sorcery: <a href="https://code.google.com/p/tinkerit/wiki/SecretVoltmeter" rel="nofollow">https://code.google.com/p/tinkerit/wiki/SecretVoltmeter</a>, or better the hardware hack &#8211; add MCP1541 to vRef, or some even more accurate (thus 10x more expensive) device, like LT1021.<br />
I did personally added LT1021 (free samples available from linear.com) &#8211; now I can calibrate expensive voltmeters with my Arduino.</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment odd alt depth-2" id="li-comment-268">
		<article id="comment-268" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/c08312fbd7a38ca3efa2e68177219108?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">Mark Olson</span> on <a href="index.html#comment-268"><time datetime="2014-01-23T19:27:47+00:00">January 23, 2014 at 7:27 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I don&#8217;t see anything in the code that assumes that MAX_ADC_VALUE corresponds to 5V. This code should work equally well over a range of +5V supply voltages, so long as the +5V supply is stable over the measurement period.</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment even depth-3" id="li-comment-281">
		<article id="comment-281" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/1de66b24ec22473be5c620e81dc2a11526e9.jpeg?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/1de66b24ec22473be5c620e81dc2a115?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn"><a href='http://wb8nbs.wordpress.com/' rel='external nofollow' class='url'>Jim</a></span> on <a href="index.html#comment-281"><time datetime="2014-01-25T03:20:20+00:00">January 25, 2014 at 3:20 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>The program calculates a ratio not an absolute voltage so supply voltage shouldn&#8217;t matter.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-261">
		<article id="comment-261" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/ad6b1c11653f4fceb739ad2f0ce9bc6f?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://none./' rel='external nofollow' class='url'>Kashan Ahmad</a></span> on <a href="index.html#comment-261"><time datetime="2014-01-23T08:29:58+00:00">January 23, 2014 at 8:29 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Excellent idea and implementation. Will definitely give it a try. Keep up the good work <img src="../../../../wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-263">
		<article id="comment-263" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt=''src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/a37322c098e2de658e4fe3dadce8cf19?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://bayesianadventures.wordpress.com/' rel='external nofollow' class='url'>aswan korula</a></span> on <a href="index.html#comment-263"><time datetime="2014-01-23T12:28:02+00:00">January 23, 2014 at 12:28 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Great piece of work!! I will have to try this out at once.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-264">
		<article id="comment-264" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/7552ec1d4288d7f4890775615b9d4803?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Dan</span> on <a href="index.html#comment-264"><time datetime="2014-01-23T16:24:38+00:00">January 23, 2014 at 4:24 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hey great job one problem, your &#8220;second equation&#8221; is incorrect, you meant to put Va0 in the denominator. Thanks for this!</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jon bypostauthor even depth-2" id="li-comment-266">
		<article id="comment-266" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/dc462521dac0765c59cc0734e6aea62e?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">jon</span> on <a href="index.html#comment-266"><time datetime="2014-01-23T18:37:55+00:00">January 23, 2014 at 6:37 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Well spotted! I could say that was a &#8220;deliberate mistake&#8221; &#8211; but it wasn&#8217;t, it was just a mistake. Thanks again for spotting that.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-265">
		<article id="comment-265" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/021ad775e3f1de625c42e7f20ac41a954165.jpeg?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/021ad775e3f1de625c42e7f20ac41a95?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Antonio</span> on <a href="index.html#comment-265"><time datetime="2014-01-23T18:09:11+00:00">January 23, 2014 at 6:09 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>in the void loop() i don&#8217;t understand the while(1) loop.<br />
Why the while(1) loop?</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jon bypostauthor even depth-2" id="li-comment-267">
		<article id="comment-267" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/dc462521dac0765c59cc0734e6aea62e?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">jon</span> on <a href="index.html#comment-267"><time datetime="2014-01-23T18:44:02+00:00">January 23, 2014 at 6:44 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>You are absolutely correct. The while(1) loop is completely unnecessary since loop() will be called continuously &#8211; so I have removed it. Thanks.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-269">
		<article id="comment-269" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/c916d37dc778e7d6cec114b4681afa15?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Tron9000</span> on <a href="index.html#comment-269"><time datetime="2014-01-23T19:58:50+00:00">January 23, 2014 at 7:58 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Nice, simple and by that merit elegant, whats not to like &#8211; well done.</p>
<p>I am right in thinking there must be a limit to the largest capacitor you can measure. The maximum current these outputs can source is 20mA?</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jon bypostauthor even depth-2" id="li-comment-270">
		<article id="comment-270" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/dc462521dac0765c59cc0734e6aea62e?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">jon</span> on <a href="index.html#comment-270"><time datetime="2014-01-23T21:40:38+00:00">January 23, 2014 at 9:40 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>It shouldn&#8217;t matter how much current can be sourced (or the rise time) &#8211; the result should be the same. The only problem may be damaging the microcontroller, but it should be fine up to about 100uF. To be on the safe side you could include series resistors, but this might mean longer delays are required to reach a steady state.</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment odd alt depth-3" id="li-comment-272">
		<article id="comment-272" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/5262b78659c2ae209c64c73cf3092f47?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">doctek</span> on <a href="index.html#comment-272"><time datetime="2014-01-24T05:18:52+00:00">January 24, 2014 at 5:18 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>A current-limiting resistor is a good idea. A cap looks like a dead short to ground when you first apply the 5V to it. Long term, this could damage an output pin. To limit 5V to 20mA requires a 250 Ohm resistor &#8211; make it 270 to be safe. An RC circuit will reach 90% of its final value in 2.2RC. So a 100pF capacitor in series with a 270 Ohm resistor will reach 4.5V in 59 nanoseconds. This can be a source of error as the cap being tested gets larger. One way to test these is to put them into an oscillator and measure the resulting frequency.</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment even depth-4" id="li-comment-273">
		<article id="comment-273" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/c916d37dc778e7d6cec114b4681afa15?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">tron9000</span> on <a href="index.html#comment-273"><time datetime="2014-01-24T09:51:54+00:00">January 24, 2014 at 9:51 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>this was my thinking. say someone building a supercap project saw this and, without thought, just hooked it up straight as show &#8211; the cap will look like a dead S/C and would damage the arduino. Maybe and extension of this project could be employing some circuitry to accommodate large caps accurately? Or you done on this one Jon?</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jon bypostauthor odd alt depth-5" id="li-comment-274">
		<article id="comment-274" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/dc462521dac0765c59cc0734e6aea62e?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">jon</span> on <a href="index.html#comment-274"><time datetime="2014-01-24T11:47:29+00:00">January 24, 2014 at 11:47 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>As long as the capacitor is discharged it should be ok&#8230; because we only apply a very short pulse (~100us &#8211; the time it takes to do the ADC conversion using analogRead()), and then discharge (which presumably would  take another 100us). After that we wait ~499,800us before we have another go.<br />
The only problem would be if someone hooked up a charged capacitor, but that could destroy the Arduino even if the I/O pins were set as inputs. I guess you could add an external resistor, but how big should that be? Someone could still hook up a capacitor charged up to hundreds of volts&#8230;</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-271">
		<article id="comment-271" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/1442e3157a4464cfd4c1236a31ee1b664165.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/1442e3157a4464cfd4c1236a31ee1b66?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Srikanth</span> on <a href="index.html#comment-271"><time datetime="2014-01-24T04:30:54+00:00">January 24, 2014 at 4:30 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>How to measure the  power factor along with the capacitance. I have a very large capacitor. I don&#8217;t know its value. So I wanted to know the powerfactor so I can purchase in large.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='http://atmelcorporation.wordpress.com/2014/01/24/arduino-uno-rigged-to-measure-capacitance  /' rel='external nofollow' class='url'>Arduino Uno rigged to measure capacitance   | Bits &amp; Pieces from the Embedded Design World</a></p>
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-276">
		<article id="comment-276" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/1de66b24ec22473be5c620e81dc2a1154165.jpeg?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/1de66b24ec22473be5c620e81dc2a115?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://wb8nbs@wordpress.com/' rel='external nofollow' class='url'>Jim</a></span> on <a href="index.html#comment-276"><time datetime="2014-01-24T17:40:53+00:00">January 24, 2014 at 5:40 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Great method! Seems to work very well.  I made a capacitive water level sensor for my sump pump long ago but this is the first cap measuring application I have found that is stable enough to use.  The water level sensor capacitance is between 40 and 450 pf, I added 100 pf to ground (IN_EXTRA_CAP_TO_GND) to make this app more accurate on the high end.  added delay(1);  right after the digitalWrite in the main loop to allow the measurement to settle, with these cap values it should settle in way less than 1 millisecond.  Now if I can port it to a Tiny85 for low power&#8230; should work A2 is not used as an analog pin here, can use a digital pin, right?</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jon bypostauthor even depth-2" id="li-comment-277">
		<article id="comment-277" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/dc462521dac0765c59cc0734e6aea62e?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">jon</span> on <a href="index.html#comment-277"><time datetime="2014-01-24T17:52:18+00:00">January 24, 2014 at 5:52 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Thank you. Yes, only IN_PIN (A0) is used as an analog input.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt depth-2" id="li-comment-282">
		<article id="comment-282" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/1de66b24ec22473be5c620e81dc2a11526e9.jpeg?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/1de66b24ec22473be5c620e81dc2a115?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn"><a href='http://wb8nbs.wordpress.com/' rel='external nofollow' class='url'>Jim</a></span> on <a href="index.html#comment-282"><time datetime="2014-01-25T03:25:10+00:00">January 25, 2014 at 3:25 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I have it working with a 2&#215;16 LCD using an SPI backpack.  Should now be portable to tiny85 is &lt; 5k compiled and needs only five I/O pins. Very happy with your design.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even depth-2" id="li-comment-883">
		<article id="comment-883" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/b8feebe972d9a3dbcfc1d7b1f5c99dde?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">Yogesh</span> on <a href="index.html#comment-883"><time datetime="2015-05-12T11:54:11+00:00">May 12, 2015 at 11:54 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hello,</p>
<p>Looks interesting !!</p>
<p>Did you add additional  Capacitor as reference as 100pf from Ao terminal to ground ??</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment odd alt thread-even depth-1" id="li-comment-278">
		<article id="comment-278" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/f5982405eeec1fc0625ea154ea7b22aa4165.jpeg?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/f5982405eeec1fc0625ea154ea7b22aa?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://www.megidish.net/' rel='external nofollow' class='url'>Gil Megidish</a></span> on <a href="index.html#comment-278"><time datetime="2014-01-24T18:36:46+00:00">January 24, 2014 at 6:36 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Brilliant! Just brilliant! What a simple and elegant idea!</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-odd thread-alt depth-1" id="li-comment-279">
		<article id="comment-279" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/021ad775e3f1de625c42e7f20ac41a954165.jpeg?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/021ad775e3f1de625c42e7f20ac41a95?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Antonio</span> on <a href="index.html#comment-279"><time datetime="2014-01-24T19:01:09+00:00">January 24, 2014 at 7:01 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>how big the capacitor can be? Can I measure electrolytic?</p>
</div>

		</article><!-- #comment-## -->

	<ul class="children">
	<li class="comment byuser comment-author-jon bypostauthor odd alt depth-2" id="li-comment-286">
		<article id="comment-286" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-small.png?s=39&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/dc462521dac0765c59cc0734e6aea62e?s=78&amp;d=mm&amp;r=g 2x' class='avatar avatar-39 photo' height='39' width='39' /><span class="fn">jon</span> on <a href="index.html#comment-286"><time datetime="2014-01-25T10:21:57+00:00">January 25, 2014 at 10:21 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I have been working on an updated version of the code that will cover the range from 1nF up to over 1000uF using the internal pullup on one of the output pins. So altogether it will be able to measure capacitors from less than 1pF to over 1000uF (nine orders of magnitude). I&#8217;m quite pleased with the result. <img src="../../../../wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /> I&#8217;ll post that as another article on here today.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-280">
		<article id="comment-280" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/fc34d631b0059fcc80485def3d32470f4165.jpeg?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/fc34d631b0059fcc80485def3d32470f?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://skinnyrd.com/' rel='external nofollow' class='url'>Jason</a></span> on <a href="index.html#comment-280"><time datetime="2014-01-24T22:36:08+00:00">January 24, 2014 at 10:36 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Nice job. I must be doing something entirely wrong though. When I upload the code and try to take a reading, I always get 1023 from A0 when a capacitor is hooked up and I get 0 to 3 when nothing is hooked up. There is no in between. I&#8217;m not sure what&#8217;s gone wrong.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-283">
		<article id="comment-283" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/ff6d7aed90e73d2cbc092f0d1807ba35?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://www.rainharvester.blogspot.com/' rel='external nofollow' class='url'>Chris</a></span> on <a href="index.html#comment-283"><time datetime="2014-01-25T03:52:55+00:00">January 25, 2014 at 3:52 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I am trying this on MSP430g2252.<br />
Draining a capacitor isn&#8217;t working:<br />
I am putting a 100uF cap (charged to 3V) across 2 GPIO pins that are set to output LOW.<br />
With a voltmeter, it is taking 30minutes to drain down to 0 V.</p>
<p>Any suggestions?  Maybe msp430 can&#8217;t drain thru the IO pins?<br />
I&#8217;m doing this for the LOW pins:</p>
<p>P1DIR  |=  pin;<br />
P1SEL  &amp;= ~pin;<br />
P1SEL2 &amp;= ~pin;<br />
P1OUT  &amp;= ~pin;<br />
P1REN  &amp;= ~pin;</p>
<p>Any suggestions?</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-284">
		<article id="comment-284" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/ff6d7aed90e73d2cbc092f0d1807ba35?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://www.rainharvester.blogspot.com/' rel='external nofollow' class='url'>Chris</a></span> on <a href="index.html#comment-284"><time datetime="2014-01-25T03:57:50+00:00">January 25, 2014 at 3:57 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>PS &#8211; I was also doing this, in addition to the above:<br />
P1OUT &amp;= ~pin;</p>
<p>Anyone else having luck draining a cap on msp430?</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-285">
		<article id="comment-285" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/ff6d7aed90e73d2cbc092f0d1807ba35?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn"><a href='http://www.rainharvester.blogspot.com/' rel='external nofollow' class='url'>Chris</a></span> on <a href="index.html#comment-285"><time datetime="2014-01-25T04:47:42+00:00">January 25, 2014 at 4:47 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>I figured it out.  My analogRead was doing this:<br />
     ADC10AE0 = (1 &lt;&lt; pin);<br />
I put this in because I saw Energia used that.  When I took this out, my capacitor drains quite quickly!</p>
<p>This is a great project!  Isn&#039;t electronics fun?!</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-292">
		<article id="comment-292" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/64d033d852a96ae9b3f6e2775ed95b58?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Damian</span> on <a href="index.html#comment-292"><time datetime="2014-01-26T01:47:47+00:00">January 26, 2014 at 1:47 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Nice post, i will try it myself in my arduino. Thank you for sharing it with us. Greetings from Argentina</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='http://skinnyrd.com/the-skinny-balloons-bikes-and-breathers/' rel='external nofollow' class='url'>The Skinny: Balloons, Bikes, and Breathers | Skinny Research and Development</a></p>
	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='http://robofun.ro/blog/cum-masori-capacitatea-unui-condensator-cu-o-placa-arduino/' rel='external nofollow' class='url'>Cum masori capacitatea unui condensator cu o placa Arduino | Robofun Blog</a></p>
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-446">
		<article id="comment-446" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/83fbf338cb615c11aac9184c4a5373a0?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">zigzagfish</span> on <a href="index.html#comment-446"><time datetime="2014-09-14T12:03:14+00:00">September 14, 2014 at 12:03 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi, this is a great solution.<br />
I&#8217;ve tried to measure my cap, which is about 30-50 pF with Arduino Due.<br />
However, the measured value for the first run and loop are quite different.<br />
In order to find the cause, I put the analogRead at A2 before A0 goes to HIGH.<br />
And then I found the init value for first run and subsequent is different and seems like the discharge is not successful. Do you have any idea? Thank you!</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-541">
		<article id="comment-541" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/7c607a04a6ffe6ca899739acfeda01c9?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">DuyTin</span> on <a href="index.html#comment-541"><time datetime="2014-11-01T10:02:28+00:00">November 1, 2014 at 10:02 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi Guy, can I use this idea for pic16f 8bit, with adc 10bit and External OSC = 20MHz.<br />
Thanks, Guy.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-641">
		<article id="comment-641" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/83055c6fd0fcaa7b7dc2e7ec8ba1836c?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">chaosbc</span> on <a href="index.html#comment-641"><time datetime="2014-12-29T16:26:40+00:00">December 29, 2014 at 4:26 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi there ,<br />
For those who want to bring a serial lcd to make an autonomous device,  I slightly modified the code as follow (you will need LiquidCrystal_V1.2.1 library)</p>
<p>#include   // Comes with Arduino IDE<br />
#include<br />
LiquidCrystal_I2C lcd(0x27, 2, 1, 0, 4, 5, 6, 7, 3, POSITIVE);  // Set the LCD I2C address<br />
const int OUT_PIN = A2;<br />
const int IN_PIN = A0;</p>
<p>//Capacitance between IN_PIN and Ground<br />
//Stray capacitance value will vary from board to board.<br />
//Calibrate this value using known capacitor.<br />
const float IN_STRAY_CAP_TO_GND = 25;<br />
const float IN_CAP_TO_GND  = IN_STRAY_CAP_TO_GND;<br />
//Pullup resistance will vary depending on board.<br />
//Calibrate this with known capacitor.<br />
const float R_PULLUP = 38.4;  //in k ohms<br />
const int MAX_ADC_VALUE = 1023;</p>
<p>void setup()<br />
{<br />
  pinMode(OUT_PIN, OUTPUT);<br />
  //digitalWrite(OUT_PIN, LOW);  //This is the default state for outputs<br />
  pinMode(IN_PIN, OUTPUT);<br />
  //digitalWrite(IN_PIN, LOW);</p>
<p>  Serial.begin(115200);<br />
  lcd.begin(16,2);<br />
}</p>
<p>void loop()<br />
{<br />
    //Capacitor under test between OUT_PIN and IN_PIN<br />
    //Rising high edge on OUT_PIN<br />
    pinMode(IN_PIN, INPUT);<br />
    digitalWrite(OUT_PIN, HIGH);<br />
    int val = analogRead(IN_PIN);<br />
    digitalWrite(OUT_PIN, LOW);</p>
<p>    if (val  u1 ? u2 &#8211; u1 : u1 &#8211; u2;<br />
      } while ((digVal &lt; 1) &amp;&amp; (t  1000.0)<br />
      {<br />
        lcd.print(capacitance / 1000.0, 2);<br />
        lcd.print(F(&#8221; uF&#8221;));<br />
      }<br />
      else<br />
      {<br />
        lcd.print(capacitance, 2);<br />
        lcd.print(F(&#8221; nF&#8221;));<br />
      }</p>
<p>      lcd.print(F(&#8221; (&#8220;));<br />
      lcd.println(F(&#8220;)&#8221;));<br />
    }<br />
    while (millis() % 1000 != 0)<br />
      ;<br />
}</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-646">
		<article id="comment-646" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/33576d80d8a6a09f80982846796e41be?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">John-Nathan</span> on <a href="index.html#comment-646"><time datetime="2014-12-31T11:04:18+00:00">December 31, 2014 at 11:04 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hey, you&#8217;ve done a great job with this, it&#8217;s going to be very useful for my project. But I have a hard time calibrating the MK II for capacitance &lt; 1nF. I&#039;ve tried the code on this article to figure it out but I get &quot;Capacitance Value = inf pF (1023)&quot;.<br />
I tried calibrating this on the other code but I don&#039;t get the correct value for capacitance under 1 nF. I&#039;m working on 123d.circuits.io</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="post pingback">
		<p>Pingback: <a href='https://sae762.wordpress.com/2015/02/09/1502/' rel='external nofollow' class='url'>Мой дневник</a></p>
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-834">
		<article id="comment-834" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/b8feebe972d9a3dbcfc1d7b1f5c99dde?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Yogesh</span> on <a href="index.html#comment-834"><time datetime="2015-04-21T07:08:56+00:00">April 21, 2015 at 7:08 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hello,<br />
you have done a great job !!<br />
This works for pF measurement but ,I would like to measure Capacitance  of fF change &#8230;<br />
Do anyone has done already this  already ??</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-837">
		<article id="comment-837" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/ee80df46d4c2a45c37e03ab5c3dc1903?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Bruce Kellett</span> on <a href="index.html#comment-837"><time datetime="2015-04-21T20:03:44+00:00">April 21, 2015 at 8:03 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>yep, very nice work, and yes the maximum sensitivity is when c(measure)=c(prob) by taking the first derivative dv/dc(t) which is the sensitivity (S) of the measurement  and dS/dc(1) is a max when ct=c1.  </p>
<p>Now S =  V/2/C and since one click is about 1/1024 of V for the arduino, I get that one click is equal to about 0.2% of the capacitance (when ct=c1).</p>
<p>Sorry for this but very rarely do I get a chance to use my college calculus!!!!!</p>
<p>Its a similar calculation for measuring resistance. </p>
<p>anyway, back to work&#8230;&#8230;.</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-987">
		<article id="comment-987" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/a3821f910b7aeda89a2a3d290da02b97?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Ehsan</span> on <a href="index.html#comment-987"><time datetime="2015-07-31T11:56:34+00:00">July 31, 2015 at 11:56 am</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi;<br />
nice job. I was wondering if this method could be used for measuring the humidity of the soil???</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-990">
		<article id="comment-990" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt='' src='../../../../../avatar/anon-large.png?s=68&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/a3821f910b7aeda89a2a3d290da02b97?s=136&amp;d=mm&amp;r=g 2x' class='avatar avatar-68 photo' height='68' width='68' /><span class="fn">Ehsan</span> on <a href="index.html#comment-990"><time datetime="2015-08-01T16:28:53+00:00">August 1, 2015 at 4:28 pm</time></a> <span class="says">said:</span>
									</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>Hi,</p>
<p>I found your article so useful and practical, it works like a charm.<br />
just one thing:<br />
changing the IN_STRAY_CAP_TO_GND does not affect the capacity calculation, so I can&#8217;t calibrate my device.</p>
<p>what should I do?</p>
</div>

		</article><!-- #comment-## -->

	</li><!-- #comment-## -->
		</ol>

		
		
	

			
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript'>
var colomatduration = 'fast';
var colomatslideEffect = 'slideFade';
</script><script type='text/javascript' src='../../../../wp-includes/js/comment-reply.min5b31.js?ver=4.3.1'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/jquery-collapse-o-matic/js/collapse00e2.js?ver=1.5.7'></script>

  <div class="alert alert-dismissible text-center cookiealert" role="alert">
	<div class="cookiealert-container">
	  Cookies &#x1F36A; We use cookies to ensure you get the best experience on our website. <a
		href="https://cookiesandyou.com/" target="_blank">Learn more</a>
	  <button type="button" class="btn btn-primary btn-sm acceptcookies" aria-label="Close">
		I agree
	  </button>
	</div>
  </div>
  <script src="/cookiealert.js"></script>

</body>

</html>
<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>General | PIC Tutorials</title>
<link rel="profile" href="../../../xfn/11.html" />
<link rel="stylesheet" type="text/css" media="all" href="../../wp-content/themes/twentyeleven/style.css" />
<link rel="alternate" type="application/rss+xml" title="PIC Tutorials &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="PIC Tutorials &raquo; Comments Feed" href="../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="PIC Tutorials &raquo; General Category Feed" href="feed/index.html" />
<link rel='stylesheet' id='collapseomatic-css-css'  href='../../wp-content/plugins/jquery-collapse-o-matic/light_style00e2.css?ver=1.5.7' type='text/css' media='all' />
<script type='text/javascript' src='../../wp-includes/js/jquery/jqueryc1d8.js?ver=1.11.3'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min1576.js?ver=1.2.1'></script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
</head>

<body class="archive category category-general category-3 single-author two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="../../index.html" rel="home">PIC Tutorials</a></span></h1>
				<h2 id="site-description">Electronics and Programming Simplified</h2>
			</hgroup>

						<a href="../../index.html">
									<img src="../../wp-content/uploads/sites/2/2013/07/cropped-header1.png" width="1000" height="288" alt="" />
							</a>
			
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="#content">Skip to primary content</a></div>
									<div class="skip-link"><a class="assistive-text" href="#secondary">Skip to secondary content</a></div>
												<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-349" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-349"><a href="../../../ham/index.html">Amateur Radio</a></li>
<li id="menu-item-351" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-351"><a href="../../about/index.html">About</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<section id="primary">
			<div id="content" role="main">

			
				<header class="page-header">
					<h1 class="page-title">Category Archives: <span>General</span></h1>

					<div class="category-archive-meta"><p>High level overviews &#8211; mainly.</p>
</div>				</header>

				
								
					
	<article id="post-317" class="post-317 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2014/01/27/cap-meter-temp-stability/index.html" rel="bookmark">Capacitance Meter Temperature Sensitivity</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2014/01/27/cap-meter-temp-stability/index.html" title="10:23 am" rel="bookmark"><time class="entry-date" datetime="2014-01-27T10:23:54+00:00">January 27, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2014/01/27/cap-meter-temp-stability/index.html#respond"><span class="leave-reply">Reply</span></a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>One of the comments was from Jim, who was interested in the temperature sensitivity of the capacatiance meter. So I&#8217;ve tested it. I took some measurements of a selection of capacitors. I then put the Arduino board in the fridge at 4C for an hour, and repeated the test. I tried to do this as quickly as possible, so the board didn&#8217;t warm up too much. The results were as follows:</p>
<p> <a href="../../2014/01/27/cap-meter-temp-stability/index.html#more-317" class="more-link">Continue reading <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
|			
					</footer><!-- .entry-meta -->
	</article><!-- #post-317 -->

				
					
	<article id="post-302" class="post-302 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2014/01/25/capacitance-meter-mk-ii/index.html" rel="bookmark">Capacitance Meter Mk II</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2014/01/25/capacitance-meter-mk-ii/index.html" title="10:25 am" rel="bookmark"><time class="entry-date" datetime="2014-01-25T10:25:54+00:00">January 25, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2014/01/25/capacitance-meter-mk-ii/index.html#comments">11</a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I was blown away with the interest in the <a title="Capacitance Meter Mk I" href="../../2014/01/21/cap-meter-with-arduino-uno/index.html">Capacitance Meter for the Arduino Uno</a>, and that encouraged me to think about how I could improve it.</p>
<p><img class="alignnone size-medium wp-image-304" style="color: #333333; font-style: normal;" alt="CapMeterMkII" src="../../wp-content/uploads/sites/2/2014/01/CapMeterMkII-300x168.jpg" width="300" height="168" /></p>
<p><a title="Capacitor tesing using internal pullup on Arduino" href="http://hackaday.com/2014/01/22/capacitance-measurement-with-the-arduino-uno/#comment-1167876">Scott made a comment on the Hackaday post</a>, and suggested using the internal pullup resistor to cover higher capacitances. I had initially ruled that out because it wouldn&#8217;t work for low value capacitors (less than about 1nF). But thinking about it again, I realized that this method could be used to extend the range up to uF values. By combining this with the method in the <a title="Capacitance meter Mk I" href="../../2014/01/21/cap-meter-with-arduino-uno/index.html">Mk I Capacitance meter</a>, I could make a capacitance meter that could measure from 1pF to over 1000uF &#8211; with no external components!</p>
<p>Actually getting this to work proved slightly more complicated than I first thought. The basic idea was going to be:</p>
<ol>
<li>Test the capacitor using the stray capacitance method. If the capacitor is less than 1nF then we are done.</li>
<li>Otherwise, we start charging the capacitor using the internal pullup.</li>
<li>After a certain amount of time (maybe the RC time constant), the capacitor will have reached a certain voltage.</li>
<li>Using the charge time and voltage (or more specifically Â the ratio of the capacitor voltage to the charging voltage) we can work out the capacitance.</li>
</ol>
<p>The time to charge larger capacitors would be in the order of milliseconds. This would be quite easy to measure with a reasonable degree of accuracy. But the RC time constant of a 1nF capacitor with a 30k pullup is about 30us. Which is more difficult to measure accurately. I thought about using interrupts, and using a hand-crafted ADC conversion method (analogRead takes about 100us &#8211; and you can do the conversion much faster than this), but I didn&#8217;t want the code to get too complicated, and I wanted to stick to the standard Arduino routines. So I came up the the following code:</p>
<h2 class="collapseomatic " id="id7722"  title="View Code">View Code</h2><div id="target-id7722" class="collapseomatic_content "></p>
<pre>const int OUT_PIN = A2;
const int IN_PIN = A0;

//Capacitance between IN_PIN and Ground
//Stray capacitance value will vary from board to board.
//Calibrate this value using known capacitor.
const float IN_STRAY_CAP_TO_GND = 24.48;
const float IN_CAP_TO_GND  = IN_STRAY_CAP_TO_GND;
//Pullup resistance will vary depending on board.
//Calibrate this with known capacitor.
const float R_PULLUP = 34.8;  //in k ohms
const int MAX_ADC_VALUE = 1023;

void setup()
{
  pinMode(OUT_PIN, OUTPUT);
  //digitalWrite(OUT_PIN, LOW);  //This is the default state for outputs
  pinMode(IN_PIN, OUTPUT);
  //digitalWrite(IN_PIN, LOW);

  Serial.begin(115200);
}

void loop()
{
    //Capacitor under test between OUT_PIN and IN_PIN
    //Rising high edge on OUT_PIN
    pinMode(IN_PIN, INPUT);
    digitalWrite(OUT_PIN, HIGH);
    int val = analogRead(IN_PIN);
    digitalWrite(OUT_PIN, LOW);

    if (val &lt; 1000)
    {
      //Low value capacitor
      //Clear everything for next measurement
      pinMode(IN_PIN, OUTPUT);

      //Calculate and print result

      float capacitance = (float)val * IN_CAP_TO_GND / (float)(MAX_ADC_VALUE - val);

      Serial.print(F("Capacitance Value = "));
      Serial.print(capacitance, 3);
      Serial.print(F(" pF ("));
      Serial.print(val);
      Serial.println(F(") "));
    }
    else
    {
      //Big capacitor - so use RC charging method

      //discharge the capacitor (from low capacitance test)
      pinMode(IN_PIN, OUTPUT);
      delay(1);

      //Start charging the capacitor with the internal pullup
      pinMode(OUT_PIN, INPUT_PULLUP);
      unsigned long u1 = micros();
      unsigned long t;
      int digVal;

      //Charge to a fairly arbitrary level mid way between 0 and 5V
      //Best not to use analogRead() here because it's not really quick enough
      do
      {
        digVal = digitalRead(OUT_PIN);
        unsigned long u2 = micros();
        t = u2 &gt; u1 ? u2 - u1 : u1 - u2;
      } while ((digVal &lt; 1) &amp;&amp; (t &lt; 400000L));

      pinMode(OUT_PIN, INPUT);  //Stop charging
      //Now we can read the level the capacitor has charged up to
      val = analogRead(OUT_PIN);

      //Discharge capacitor for next measurement
      digitalWrite(IN_PIN, HIGH);
      int dischargeTime = (int)(t / 1000L) * 5;
      delay(dischargeTime);    //discharge slowly to start with
      pinMode(OUT_PIN, OUTPUT);  //discharge remainder quickly
      digitalWrite(OUT_PIN, LOW);
      digitalWrite(IN_PIN, LOW);

      //Calculate and print result
      float capacitance = -(float)t / R_PULLUP
                              / log(1.0 - (float)val / (float)MAX_ADC_VALUE);

      Serial.print(F("Capacitance Value = "));
      if (capacitance &gt; 1000.0)
      {
        Serial.print(capacitance / 1000.0, 2);
        Serial.print(F(" uF"));
      }
      else
      {
        Serial.print(capacitance, 2);
        Serial.print(F(" nF"));
      }

      Serial.print(F(" ("));
      Serial.print(digVal == 1 ? F("Normal") : F("HighVal"));
      Serial.print(F(", t= "));
      Serial.print(t);
      Serial.print(F(" us, ADC= "));
      Serial.print(val);
      Serial.println(F(")"));
    }
    while (millis() % 1000 != 0)
      ;    
}</pre>
<p></div>
<p>I&#8217;ll try to explain why I coded it this way&#8230; I tried using analogRead() to determine when the capacitor had charged up to a certain value. This could work, but analogRead() is very slow so I decided to use the input as a digital input to start with. When the input gets to about 2.5V the input will change from 0 to 1 and we stop charging the capacitor. At this point we really can&#8217;t be sure what the the voltage is across the capacitor, so we use analogRead to get an accurate value. We have taken timestamps at the start and end of the charging process, so now we have everything we need to determine the capacitance. The maths behind this is as follows:</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/RC_Charging1.png"><img class="alignnone size-medium wp-image-308" alt="RC_Charging1" src="../../wp-content/uploads/sites/2/2014/01/RC_Charging1-300x159.png" width="300" height="159" /></a></p>
<p>For the circuit above, the formulas that we need are:</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/RCFormula1.png"><img class="alignnone size-medium wp-image-309" alt="RCFormula1" src="../../wp-content/uploads/sites/2/2014/01/RCFormula1-300x166.png" width="300" height="166" /></a></p>
<p>Initially I assumed that the pullup resistor had a value of 30k. This won&#8217;t be correct and should be calibrated using a capacitor of a known value. Something around about 100nF &#8211; 1uF should give a good measurement (don&#8217;t use an electrolytic &#8211; these tend to have very poor tolerance, typically -20%,Â +80%!). By putting these numbers into the last formula, we can determine the actual pullup resistance.</p>
<p>I used a 1uF capacitor and got the following result:</p>
<p><span style="color: #0000ff;">Capacitance Value = 1.00 uF (Normal, t= 24704 us, ADC= 520)</span></p>
<p><em>[Note that at this point the measured capacitance probably won&#8217;t be 1.00uF]</em></p>
<p>Putting these numbers (C = 1e-6F, t = 0.024704s, Vc=520, Vin=1023) into the last formula gives us the result: R = 34.80 kÎ© (34800Î©). For <strong>C</strong> we should use the expected value (1.00uF) rather than the measured value which, as previously stated, is likely to be different until we have done the calibration.</p>
<p>I then tested this with various capacitors.</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/dec9caps.jpg"><img class="alignnone size-medium wp-image-312" alt="dec9caps" src="../../wp-content/uploads/sites/2/2014/01/dec9caps-300x168.jpg" width="300" height="168" /></a></p>
<p>These were my results:</p>
<h2 class="collapseomatic " id="id4862"  title="Results">Results</h2><div id="target-id4862" class="collapseomatic_content "></p>
<table width="361" border="0" cellspacing="0" cellpadding="0">
<colgroup>
<col width="84" />
<col width="277" /> </colgroup>
<tbody>
<tr>
<td width="84" height="17">Capacitor</td>
<td width="277">Reading</td>
</tr>
<tr>
<td height="17">5pF +-.5pF</td>
<td>5.404 pF (185)</td>
</tr>
<tr>
<td height="17">101J</td>
<td>102.000 pF (825)</td>
</tr>
<tr>
<td height="17">471K</td>
<td>457.117 pF (971)</td>
</tr>
<tr>
<td height="17">102K</td>
<td>0.95 nF (Normal, t= 32 us, ADC= 636)</td>
</tr>
<tr>
<td height="17">222K</td>
<td>2.07 nF (Normal, t= 64 us, ADC= 602)</td>
</tr>
<tr>
<td height="17">103K</td>
<td>10.50 nF (Normal, t= 272 us, ADC= 537)</td>
</tr>
<tr>
<td height="17">104K</td>
<td>112.39 nF (Normal, t= 2800 us, ADC= 523)</td>
</tr>
<tr>
<td height="17">105K</td>
<td>986.04 nF (Normal, t= 24428 us, ADC= 521)</td>
</tr>
<tr>
<td height="17">106K (tant.)</td>
<td>11.75 uF (Normal, t= 291124 us, ADC= 521)</td>
</tr>
<tr>
<td height="17">4.7u (elec.)</td>
<td>5.02 uF (Normal, t= 124108 us, ADC= 520)</td>
</tr>
<tr>
<td height="17">10u (elec.)</td>
<td>12.12 uF (Normal, t= 299352 us, ADC= 520)</td>
</tr>
<tr>
<td height="17">220u (elec.)</td>
<td>224.77 uF (HighVal, t= 400004 us, ADC= 51)</td>
</tr>
<tr>
<td height="17">1000u (elec.)</td>
<td>1170.11 uF (HighVal, t= 400000 us, ADC= 10)</td>
</tr>
</tbody>
</table>
<p></div>
<p>When testing electrolytics make sure that you connect the +ve end to A2 and the negative end to A0.</p>
<p>I&#8217;m not sure how accurate this is, but I will look into this (and try to improve it if necessary) when I get a chance.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
| </span>
						<span class="comments-link"><a href="../../2014/01/25/capacitance-meter-mk-ii/index.html#comments"><b>11</b> Replies</a></span>
			
					</footer><!-- .entry-meta -->
	</article><!-- #post-302 -->

				
					
	<article id="post-277" class="post-277 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2014/01/22/experiments-with-uno-cap-meter/index.html" rel="bookmark">Experiments with the Arduino Capacitance Meter</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2014/01/22/experiments-with-uno-cap-meter/index.html" title="11:25 am" rel="bookmark"><time class="entry-date" datetime="2014-01-22T11:25:05+00:00">January 22, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2014/01/22/experiments-with-uno-cap-meter/index.html#comments">5</a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>No hack these days would be complete without the inclusion of a mint tin (although usually as a case); so we are going to build a capacitor with two tins, and compare it&#8217;s <a title="Arduino Capacitance Meter" href="../../2014/01/21/cap-meter-with-arduino-uno/index.html">measured value</a> against it&#8217;s calculated value.</p>
<p>Any two flat bits of metal would do, but I had two of these tins to hand, so that&#8217;s what I used.</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/mint_tin_capacitor.jpg"><img class="alignnone size-medium wp-image-278" alt="mint_tin_capacitor" src="../../wp-content/uploads/sites/2/2014/01/mint_tin_capacitor-300x165.jpg" width="300" height="165" /></a></p>
<p> <a href="../../2014/01/22/experiments-with-uno-cap-meter/index.html#more-277" class="more-link">Continue reading <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
| </span>
						<span class="comments-link"><a href="../../2014/01/22/experiments-with-uno-cap-meter/index.html#comments"><b>5</b> Replies</a></span>
			
					</footer><!-- .entry-meta -->
	</article><!-- #post-277 -->

				
					
	<article id="post-262" class="post-262 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2014/01/22/arduino-lcr-meter-ideas/index.html" rel="bookmark">Arduino LCR meter &#8211; ideas</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2014/01/22/arduino-lcr-meter-ideas/index.html" title="9:46 am" rel="bookmark"><time class="entry-date" datetime="2014-01-22T09:46:06+00:00">January 22, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2014/01/22/arduino-lcr-meter-ideas/index.html#comments">3</a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>Further to the <a title="Arduino Capacitance Meter" href="../../2014/01/21/cap-meter-with-arduino-uno/index.html">Arduino Capacitance Meter</a>, if your feeling adventurous, or want to make a complete LCR meter I have a few more ideas&#8230;</p>
<h2> <a href="../../2014/01/22/arduino-lcr-meter-ideas/index.html#more-262" class="more-link">Continue reading <span class="meta-nav">&rarr;</span></a></h2>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
| </span>
						<span class="comments-link"><a href="../../2014/01/22/arduino-lcr-meter-ideas/index.html#comments"><b>3</b> Replies</a></span>
			
					</footer><!-- .entry-meta -->
	</article><!-- #post-262 -->

				
					
	<article id="post-250" class="post-250 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2014/01/21/arduino-cap-meter-res/index.html" rel="bookmark">Arduino Capacitance Meter Resolution</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2014/01/21/arduino-cap-meter-res/index.html" title="7:21 pm" rel="bookmark"><time class="entry-date" datetime="2014-01-21T19:21:03+00:00">January 21, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2014/01/21/arduino-cap-meter-res/index.html#respond"><span class="leave-reply">Reply</span></a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I worked out the theoretical resolution of the <a title="Arduino Uno Capacitance Meter" href="../../2014/01/21/cap-meter-with-arduino-uno/index.html">Arduino Uno capacitance meter</a> using a spreadsheet. Resolution is the ability to distinguish between nearby values; It is not the same as accuracy. In a way, accuracy can be viewed as an absolute error, whereas resolution is relative error.</p>
<p> <a href="../../2014/01/21/arduino-cap-meter-res/index.html#more-250" class="more-link">Continue reading <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
|			
					</footer><!-- .entry-meta -->
	</article><!-- #post-250 -->

				
					
	<article id="post-229" class="post-229 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2014/01/21/cap-meter-with-arduino-uno/index.html" rel="bookmark">Capacitance measurement with the Arduino Uno</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2014/01/21/cap-meter-with-arduino-uno/index.html" title="4:06 pm" rel="bookmark"><time class="entry-date" datetime="2014-01-21T16:06:19+00:00">January 21, 2014</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2014/01/21/cap-meter-with-arduino-uno/index.html#comments">41</a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>You can buy meters, like this one for instance:</p>
<p><a title="PEAK LCR40" href="http://www.peakelec.co.uk/acatalog/jz_lcr40.html"><img class="alignnone size-medium wp-image-231" style="color: #333333; font-style: normal;" alt="Peak_LCR40" src="../../wp-content/uploads/sites/2/2014/01/Peak_LCR40-300x201.jpg" width="300" height="201" /></a></p>
<p>that measure capacitance, but where&#8217;s the fun in that?!</p>
<p>If you&#8217;ve got an Arduino, why not build one instead?</p>
<p><strong>Update:</strong>Â Thank you for all the interest in this article! I have managed to increase the range, so it can measure capacitances of less than 1pF to over 1000uF , still with no external components! I&#8217;ve called this the <a title="Capacitance Meter Mk II" href="../../2014/01/25/capacitance-meter-mk-ii/index.html">Capacitance Meter Mk II</a>.</p>
<p>There are lots of examples of how to do this on the internet, but I&#8217;m going to suggest an incredibly simple way to it. Let&#8217;s start with the theory.</p>
<p>Consider the following circuit:</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/SimpleCapacitanceTester.png"><img class="alignnone size-medium wp-image-232" alt="SimpleCapacitanceTester" src="../../wp-content/uploads/sites/2/2014/01/SimpleCapacitanceTester-300x226.png" width="300" height="226" /></a></p>
<p>CT is the capacitor under test. We start with both capacitors discharged and A2 at 0 volts. When we raise A2 to 5 volts a current will flow through both capacitors. The voltage on A0 will settle to within 1% of it&#8217;s final value within 30ns. The value that A0 will settle to is proportional to the ratio of CT divided by the total capacitance, C1 + CT. The formulas that we are going to need are:</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/CapTestFormulas3.png"><img class="alignnone size-full wp-image-300" alt="CapTestFormulas3" src="../../wp-content/uploads/sites/2/2014/01/CapTestFormulas3.png" width="284" height="297" /></a></p>
<p>We will use the ADC to measure VA0. VA2 is actually 5 volts, Â so VA0 will vary from 0 to 5 volts, but we can use the ADC value instead, to make the calculations easier. Obviously we should then use the maximum ADC value (1023) for VA2. The ADC readings we can expect will range from about 33 for CT = 1pF to about 993 for CT = 1nF (1000pF).</p>
<p>So now we are ready to build the circuit and write the code. Right? Well, not quite. In the circuit above we have specified C1 as 30pF. But the Arduino will have some stray capacitance on the board and in the micro-controller. About 30pF of stray capacitance. We&#8217;re going to use this to make our circuit simpler &#8211; we are going to remove C1. But we need to work out how much stray capacitance there is, so we can plug it into the formulas above. But first, we&#8217;ll build the circuit and write the code.</p>
<p>The circuit is surprisingly easy. In fact there isn&#8217;t a circuit now. We&#8217;re going to use the Arduino as follows:</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/CapTestBoard1.jpg"><img class="alignnone size-medium wp-image-236" alt="CapTestBoard1" src="../../wp-content/uploads/sites/2/2014/01/CapTestBoard1-300x168.jpg" width="300" height="168" /></a></p>
<p>The capacitor is the capacitor under test between A0 and A2. The capacitors on the right are the capacitors that I am going to test a bit later on.</p>
<p>The code looks like this:</p>
<pre>const int OUT_PIN = A2;
const int IN_PIN = A0;

//Capacitance between IN_PIN and Ground
//Stray capacitance is always present. Extra capacitance can be added to
//allow higher capacitance to be measured.
const float IN_STRAY_CAP_TO_GND = 24.48; //initially this was 30.00
const float IN_EXTRA_CAP_TO_GND = 0.0;
const float IN_CAP_TO_GND  = IN_STRAY_CAP_TO_GND + IN_EXTRA_CAP_TO_GND;
const int MAX_ADC_VALUE = 1023;

void setup()
{
  pinMode(OUT_PIN, OUTPUT);
  //digitalWrite(OUT_PIN, LOW);  //This is the default state for outputs
  pinMode(IN_PIN, OUTPUT);
  //digitalWrite(IN_PIN, LOW);

  Serial.begin(115200);
}

void loop()
{
  //Capacitor under test between OUT_PIN and IN_PIN
  //Rising high edge on OUT_PIN
  pinMode(IN_PIN, INPUT);
  digitalWrite(OUT_PIN, HIGH);
  int val = analogRead(IN_PIN);

  //Clear everything for next measurement
  digitalWrite(OUT_PIN, LOW);
  pinMode(IN_PIN, OUTPUT);

  //Calculate and print result

  float capacitance = (float)val * IN_CAP_TO_GND / (float)(MAX_ADC_VALUE - val);

  Serial.print(F("Capacitance Value = "));
  Serial.print(capacitance, 3);
  Serial.print(F(" pF ("));
  Serial.print(val);
  Serial.println(F(") "));

  while (millis() % 500 != 0)
    ;    
}</pre>
<p>The code above loops round every half second, applying a 5V pulse to the capacitor, and measuring the voltage the other side. It then prints out the calculated capacitance (and raw ADC value).</p>
<p>If we try this out it won&#8217;t be very accurate. That is because the stray capacitance isn&#8217;t exactly 30pF. So we need to calibrate it. I did this with a 100pF capacitor. My multimeter reckons that it actually has a value of 102pF. The reading I get on my Arduino board is 125pF (raw ADC value 825). So if we put VA0 = 825, VA2 = 1023 and CT = 102 into the second equation, this tells us that C1 is 24.48pF. So I changedÂ IN_STRAY_CAP_TO_GND to 24.48 and uploaded this to the Arduino. This time the value displayed on the serial monitor is 102pF (most of the time!).</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/CapTestSerialMon1.png"><img class="alignnone size-medium wp-image-241" alt="CapTestSerialMon1" src="../../wp-content/uploads/sites/2/2014/01/CapTestSerialMon1-300x124.png" width="300" height="124" /></a></p>
<p>I tried it out with the following capacitors:</p>
<p><a href="../../wp-content/uploads/sites/2/2014/01/MiscCap1.jpg"><img class="alignnone size-medium wp-image-243" alt="MiscCap1" src="../../wp-content/uploads/sites/2/2014/01/MiscCap1-300x168.jpg" width="300" height="168" /></a></p>
<p>This was the results of my tests:</p>
<table width="189" border="0" cellspacing="0" cellpadding="0">
<colgroup>
<col width="63" />
<col width="126" /> </colgroup>
<tbody>
<tr>
<td width="63" height="17">Capacitor</td>
<td width="126">Reading</td>
</tr>
<tr>
<td height="7"></td>
<td></td>
</tr>
<tr>
<td height="17">&#8211;</td>
<td>0.072 pF (3)</td>
</tr>
<tr>
<td height="17">15J</td>
<td>15.461 pF (396)</td>
</tr>
<tr>
<td height="17">22J</td>
<td>23.403 pF (500)</td>
</tr>
<tr>
<td height="17">47J</td>
<td>48.532 pF (680)</td>
</tr>
<tr>
<td height="17">101J</td>
<td>102.000 pF (825)</td>
</tr>
<tr>
<td height="17">471K</td>
<td>448.030 pF (970)</td>
</tr>
<tr>
<td height="17">102K</td>
<td>1064.348 pF (1000)</td>
</tr>
<tr>
<td height="17">392K</td>
<td>3553.097 pF (1016)</td>
</tr>
<tr>
<td height="17">472K</td>
<td>4984.128 pF (1018)</td>
</tr>
</tbody>
</table>
<p>I was curious to know how accurate this might be, so I worked it out. <a title="Aduino Uno Capacitance Meter Resolution" href="../../2014/01/21/arduino-cap-meter-res/index.html">You can see the results of my analysis here</a>. My conclusion was that you could expect a resolution of about 1% between 3.5pF and 225pF, and about 5% between 0.5pF and 1300pF. I haven&#8217;t worked the accuracy and linearity yet &#8211; I need to get hold of some very accurate reference capacitors (or a very accurate meter) for that.</p>
<p>You can build your own capacitor, and do experiments, <a title="Experiments with the Arduino Capacitance Meter" href="../../2014/01/22/experiments-with-uno-cap-meter/index.html">which I have demonstrated here</a>.</p>
<p>If you want to build on this or make a complete LCR meter, I <a title="Arduino LCR Meter Ideas" href="../../2014/01/22/arduino-lcr-meter-ideas/index.html">have some ideas here</a>.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
| </span>
						<span class="comments-link"><a href="../../2014/01/21/cap-meter-with-arduino-uno/index.html#comments"><b>41</b> Replies</a></span>
			
					</footer><!-- .entry-meta -->
	</article><!-- #post-229 -->

				
					
	<article id="post-10" class="post-10 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2013/07/11/which-micro-controller-should-you-use/index.html" rel="bookmark">Which micro-controller should you use?</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2013/07/11/which-micro-controller-should-you-use/index.html" title="2:13 pm" rel="bookmark"><time class="entry-date" datetime="2013-07-11T14:13:34+00:00">July 11, 2013</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2013/07/11/which-micro-controller-should-you-use/index.html#respond"><span class="leave-reply">Reply</span></a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p>Note: I may do a video to accompany this later. Let me know if that would be of interest&#8230;</p>
<p><strong>A Short Introduction</strong></p>
<p>Micro-controllers have been around aÂ <em>long</em>Â time. Just recently though they have attracted a lot more interest, thanks mainly to the Arduino boards. People all over the world are now building Â all sorts of exotic and innovative creations. If you are new to micro-controllers you would be well advised to start with an Arduino board (<a title="Arduino website" href="http://arduino.cc/en/" target="_blank">Arduino website</a>).</p>
<p>Once you have played with this for a while you will probably be interested in getting some of theÂ <em>shields</em>Â (plug in boards) that help out with tasks like driving motors (e.g. for robots) or LCD displays or connecting via wireless. USB or ethernet etc.</p>
<p>You will also discover that there are other boards available &#8211; using different processors. The ones that I&#8217;m going to mention here are the PIC based ones made by Digilent (chipKIT). These are the Uno32, uC32, DP32 and Max32. They are all based on the PIC32 chips. They run a lot faster than the Arduino boards (which are based on Atmel processors). Be warned though that you won&#8217;t be able to use the Arduino IDE &#8211; you have to use a specially adapted version called MPIDE. The idea is that you should be able to use sketches built for Arduino boards and recompile them without modification using MPIDE for the chipKIT boards. In practice, it&#8217;s not always as easy as that, so if you decide you want the faster speed and extra features, you may have to put up with having less support than you get with the Arduino boards.</p>
<p>There is another approach, which I am going to use &#8211; which is to use the PIC devices directly. Also, instead of using the MPIDE, I will be using Microchip&#8217;s IDE &#8211; MPLABX. Microchip provide three free compilers &#8211; XC8, XC16 and XC32 depending on whether you are programming an 8bit, 16bit or 32bit chip. They also provide an assember &#8211; MPASM if you need really feel the need to write the code directly in assembler!</p>
<p>You can use the chipKIT boards with MPLABX, but to be honest, if you are going down this route you might as well just program straight to the device itself. You&#8217;ll need a few external components, but you can build this all on a small breadboard, like this one:</p>
<p><a href="../../wp-content/uploads/sites/2/2013/07/Breadboard400.png"><img class="alignnone size-medium wp-image-15" alt="Breadboard400" src="../../wp-content/uploads/sites/2/2013/07/Breadboard400-300x200.png" width="300" height="200" /></a></p>
<p>You will need to get a programmer / debugger, and the one that I would recommend is the PICkit 3. This connects your PC (Windows, MAC or linux) via USB, and to the board via a 6 pin header. This is obviously more effort that using the Arduino IDE or MPIDE, but there are several benefits to this extra effort:</p>
<ul>
<li>Debugging (including breakpoints and register / variable inspection).</li>
<li>Ability to use a much wider range of devices.</li>
<li>Easier to understand hardware (most projects can be done with very few external components).</li>
</ul>
<p>There are many other benefits &#8211; this is just some of them.</p>
<p>So if you&#8217;ve got here, you&#8217;re either an advanced user, or you&#8217;re felling brave and want to do some real hacking with real devices. If it&#8217;s the latter I applaud your ambition!</p>
<p>I will try to make this as painless as possible with the upcoming Â tutorials. I am sure that you will find it much more satisfying than using a pre-built board.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
|			
					</footer><!-- .entry-meta -->
	</article><!-- #post-10 -->

				
					
	<article id="post-8" class="post-8 post type-post status-publish format-standard hentry category-general">
		<header class="entry-header">
						<h1 class="entry-title"><a href="../../2013/07/11/road-map/index.html" rel="bookmark">Road Map</a></h1>
			
						<div class="entry-meta">
				<span class="sep">Posted on </span><a href="../../2013/07/11/road-map/index.html" title="2:13 pm" rel="bookmark"><time class="entry-date" datetime="2013-07-11T14:13:06+00:00">July 11, 2013</time></a><span class="by-author">by </span> <span class="author vcard"><a class="url fn n" href="../../author/jon/index.html" title="View all posts by jon" rel="author">jon</a></span></span>			</div><!-- .entry-meta -->
			
						<div class="comments-link">
				<a href="../../2013/07/11/road-map/index.html#respond"><span class="leave-reply">Reply</span></a>			</div>
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p><a href="../../wp-content/uploads/sites/2/2013/07/variousPICs.jpg"><img alt="variousPICs" src="../../wp-content/uploads/sites/2/2013/07/variousPICs-300x118.jpg" width="300" height="118" /></a></p>
<p>Welcome to my PIC tutorials. Over the coming weeks and months I plan to show some exciting ways to use the PIC micro-controllers. I&#8217;ll be working with devices from the PIC10 all the way up to the PIC32. Most of these devices are very inexpensive, but they really can do a LOT.</p>
<p>I&#8217;ll start by looking at what&#8217;s available, and then I&#8217;ll dive into programming some simple examples.</p>
<p>I&#8217;ll also occasionally include some articles about Arduino and chipKIT boards.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
												<span class="cat-links">
				<span class="entry-utility-prep entry-utility-prep-cat-links">Posted in</span> <a href="index.html" rel="category tag">General</a>			</span>
															
|			
					</footer><!-- .entry-meta -->
	</article><!-- #post-8 -->

				
				
			
			</div><!-- #content -->
		</section><!-- #primary -->

		<div id="secondary" class="widget-area" role="complementary">
			<aside id="search-2" class="widget widget_search"></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
					<li>
				<a href="../../2014/03/14/next-project/index.html">Next Project</a>
						</li>
					<li>
				<a href="../../2014/03/13/improved-arduino-wireless-board/index.html">Improved Arduino Wireless Board</a>
						</li>
					<li>
				<a href="../../2014/01/27/cap-meter-temp-stability/index.html">Capacitance Meter Temperature Sensitivity</a>
						</li>
					<li>
				<a href="../../2014/01/25/capacitance-meter-mk-ii/index.html">Capacitance Meter Mk II</a>
						</li>
					<li>
				<a href="../../2014/01/22/experiments-with-uno-cap-meter/index.html">Experiments with the Arduino Capacitance Meter</a>
						</li>
				</ul>
		</aside><aside id="text-3" class="widget widget_text">			<div class="textwidget"><script async src="../../../pagead/js/f.txt"></script>
<!-- d4def396-a457-4882-90f7-74ec2980bba3 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6883435305856536"
     data-ad-slot="3063473247"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
		</aside><aside id="recent-comments-2" class="widget widget_recent_comments"><h3 class="widget-title">Recent Comments</h3><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link">Eric</span> on <a href="../../2014/01/25/capacitance-meter-mk-ii/index.html#comment-1102">Capacitance Meter Mk II</a></li><li class="recentcomments"><span class="comment-author-link">Ravi Shankar</span> on <a href="../../2013/12/11/nrf24l01sw/index.html#comment-1071">Wireless Communication using the nRF24L01 Module</a></li><li class="recentcomments"><span class="comment-author-link">Ehsan</span> on <a href="../../2014/01/21/cap-meter-with-arduino-uno/index.html#comment-990">Capacitance measurement with the Arduino Uno</a></li><li class="recentcomments"><span class="comment-author-link">Ehsan</span> on <a href="../../2014/01/21/cap-meter-with-arduino-uno/index.html#comment-987">Capacitance measurement with the Arduino Uno</a></li><li class="recentcomments"><span class="comment-author-link">Andreas</span> on <a href="../../2014/01/25/capacitance-meter-mk-ii/index.html#comment-929">Capacitance Meter Mk II</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
	<li><a href='../../2014/03/index.html'>March 2014</a></li>
	<li><a href='../../2014/01/index.html'>January 2014</a></li>
	<li><a href='../../2013/12/index.html'>December 2013</a></li>
	<li><a href='../../2013/07/index.html'>July 2013</a></li>
		</ul>
</aside><aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-3 current-cat"><a href="index.html" title="High level overviews - mainly.">General</a>
</li>
	<li class="cat-item cat-item-2"><a href="../usingmplabx/index.html" title="Everything you need to get you started with the MicroChip MPLABX and a PIC.">Getting Started With MPLABX</a>
</li>
	<li class="cat-item cat-item-4"><a href="../pic-usb-solutions/index.html" >PIC USB Solutions</a>
</li>
	<li class="cat-item cat-item-1"><a href="../uncategorized/index.html" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-5"><a href="../wireless-dev/index.html" title="Wireless development and solutions">Wireless Development</a>
</li>
		</ul>
</aside></div><!-- #secondary .widget-area -->

	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript'>
var colomatduration = 'fast';
var colomatslideEffect = 'slideFade';
</script><script type='text/javascript' src='../../wp-content/plugins/jquery-collapse-o-matic/js/collapse00e2.js?ver=1.5.7'></script>

</body>
</html>